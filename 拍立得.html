<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-19BLJQLP2E"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-19BLJQLP2E');
  </script>
    
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>å¤å¤ç›¸æœºæ¨¡æ‹Ÿå™¨</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="ç”¨ä½ çš„ç›¸æœºæ‹æ‘„å³æ—¶æ‹ç«‹å¾—ç…§ç‰‡ï¼ä½“éªŒå¤å¤æ‘„å½±çš„ä¹è¶£ï¼Œæ‹–æ‹½ã€æ•´ç†å¹¶ä¸‹è½½ä½ çš„ç…§ç‰‡å¢™ã€‚" />
    
    <!-- Favicons -->
    <!-- âœ… å·²æ›¿æ¢ï¼šä½¿ç”¨ç›¸æœºå›¾ç‰‡ä½œä¸ºå›¾æ ‡ -->
    <link rel="icon" type="image/x-icon" href="https://photo.hackflow.com.cn/assets/retro-camera.webp" />
    
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap');
      /* é¢å¤–å¼•å…¥ä¸€ä¸ªæ”¯æŒä¸­æ–‡æ‰‹å†™é£æ ¼çš„å­—ä½“ï¼ˆè™½ç„¶ Permanent Marker ä¸æ”¯æŒä¸­æ–‡ï¼Œä½†ä½œä¸ºå¤‡é€‰å¾ˆé…·ï¼Œä¸­æ–‡å°†å›é€€åˆ°ç³»ç»Ÿå­—ä½“ï¼‰ */
      @import url('https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&display=swap');

      * {
        box-sizing: border-box;
        outline: none;
      }

      body {
        margin: 0;
        padding: 0;
        background-color: #d4d4d4;
        background-image: radial-gradient(#e0e0e0 15%, transparent 16%),
          radial-gradient(#e0e0e0 15%, transparent 16%);
        background-size: 20px 20px;
        background-position: 0 0, 10px 10px;
        height: 100vh;
        width: 100vw;
        font-family: 'Ma Shan Zheng', 'Permanent Marker', sans-serif; /* ä¼˜å…ˆä½¿ç”¨ä¸­æ–‡æ‰‹å†™å­—ä½“ */
        overflow: hidden;
        display: flex;
        flex-direction: row;
        user-select: none;
        touch-action: none;
      }

      .camera-zone {
        flex: 0 0 50%;
        max-width: 600px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: center;
        position: relative;
        z-index: 20;
        padding: 20px;
        padding-bottom: 80px;
      }

      .camera-wrapper {
        position: relative;
        width: 100%;
        max-width: 450px;
        aspect-ratio: 1 / 1;
      }

      .camera-img {
        width: 100%;
        height: auto;
        position: relative;
        z-index: 20;
        pointer-events: none;
        filter: drop-shadow(0 20px 30px rgba(0, 0, 0, 0.4));
      }

      .lens-wrapper {
        position: absolute;
        bottom: 33%;
        left: 62%;
        transform: translateX(-50%);
        width: 26%;
        height: 26%;
        border-radius: 50%;
        overflow: hidden;
        z-index: 25;
        background: #000;
        box-shadow: inset 0 0 15px #000;
      }

      video#cam-feed {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transform: scaleX(-1);
        opacity: 0.9;
      }

      .lens-shine {
        position: absolute;
        top: 15%;
        left: 15%;
        width: 30%;
        height: 20%;
        background: rgba(255, 255, 255, 0.3);
        transform: rotate(-45deg);
        filter: blur(3px);
        z-index: 26;
        pointer-events: none;
      }

      .shutter-btn {
        position: absolute;
        bottom: 42%;
        left: 18%;
        width: 11%;
        height: 11%;
        border-radius: 50%;
        z-index: 30;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
      }

      .ejection-slot {
        position: absolute;
        z-index: 15;
        top: -40%;
        left: 50%;
        transform: translateX(-50%);
        width: 35%;
        height: 100%;
        pointer-events: none;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding-bottom: 20%;
      }

      .desk-zone {
        flex: 1;
        position: relative;
        height: 100%;
      }

      /* --- Buttons --- */
      .btn-container {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 200;
        display: flex;
        gap: 10px;
      }

      .action-btn {
        background: rgba(255, 255, 255, 0.9);
        border: 2px solid #d93025;
        color: #d93025;
        padding: 8px 16px;
        border-radius: 20px;
        font-family: 'Ma Shan Zheng', 'Permanent Marker', cursive;
        font-size: 16px;
        cursor: pointer;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        transition: all 0.2s;
        letter-spacing: 1px;
      }

      .action-btn:hover {
        background: #d93025;
        color: white;
      }

      .action-btn:active {
        transform: scale(0.95);
      }

      #download-btn {
        border-color: #222;
        color: #222;
      }
      #download-btn:hover {
        background: #222;
        color: white;
      }

      /* --- Polaroid Styling --- */
      .polaroid {
        width: 170px;
        background: #fdfdfd;
        padding: 10px 10px 55px 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        position: absolute;
        cursor: grab;
        pointer-events: auto;
        transform-origin: center center;
        touch-action: none;
        /* ä¼˜åŒ–ï¼šå¢åŠ  transform çš„è¿‡æ¸¡ï¼Œè®©æ‘†åŠ¨æ›´å¹³æ»‘ï¼›å¢åŠ  box-shadow è¿‡æ¸¡ */
        transition: transform 0.1s linear, box-shadow 0.3s ease;
        will-change: transform, left, top;
      }

      /* æ‹–æ‹½çŠ¶æ€æ ·å¼ï¼ˆç”± JS æ·»åŠ ç±»åæ§åˆ¶ï¼‰ */
      .polaroid.is-dragging {
        cursor: grabbing;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.35); /* æ‚¬æµ®æ—¶é˜´å½±æ›´æ·± */
        z-index: 10000 !important;
        transition: box-shadow 0.3s ease; /* åªæœ‰é˜´å½±å¹³æ»‘è¿‡æ¸¡ï¼Œtransform ç”± JS å®æ—¶æ§åˆ¶ */
      }

      /* è½åœ°æ—¶çš„å¼¹æ€§åŠ¨ç”» */
      .polaroid.dropped {
        transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.3s ease !important;
      }

      .polaroid:active {
        /* ä¿ç•™ active çŠ¶æ€ä½œä¸ºå¤‡ç”¨ï¼Œä¸»è¦é€»è¾‘ç§»äº¤ JS */
        cursor: grabbing;
      }

      .polaroid img {
        width: 100%;
        height: 170px;
        object-fit: cover;
        background: #222;
        border: 1px solid #e0e0e0;
        pointer-events: none;
        display: block;
        filter: blur(0) grayscale(0) brightness(1);
        will-change: filter;
      }

      .polaroid.developing-start img {
        filter: blur(15px) grayscale(0.5) brightness(0.9);
      }

      .polaroid.developing-slow img {
        transition: filter 6s ease-in-out;
        filter: blur(0) grayscale(0) brightness(1);
      }

      .polaroid.developing-fast img {
        transition: filter 3s ease-out !important;
        filter: blur(0) grayscale(0) brightness(1);
      }

      .polaroid .caption-main {
        position: absolute;
        bottom: 22px;
        left: 10px;
        width: 150px;
        text-align: center;
        color: #222;
        opacity: 0.9;
        cursor: text;
        font-family: 'Ma Shan Zheng', 'Permanent Marker', cursive;
        font-size: 16px;
        line-height: 1.1;
        min-height: 18px;
      }
      
      .polaroid .caption-main:empty::before {
        content: 'è®°å½•ç¾å¥½ç¬é—´';
        opacity: 0.5;
      }

      .polaroid .caption-date {
        position: absolute;
        bottom: 8px;
        left: 10px;
        width: 150px;
        text-align: center;
        font-family: 'Ma Shan Zheng', 'Permanent Marker', cursive;
        font-size: 12px;
        color: #555;
        pointer-events: none;
        user-select: none;
      }

      .polaroid.ejecting {
        transform: translateY(100%);
        animation: riseOut 2s cubic-bezier(0.23, 1, 0.32, 1) forwards;
      }

      @keyframes riseOut {
        0% {
          transform: translateY(100%);
          opacity: 1;
        }
        100% {
          transform: translateY(-50px);
          opacity: 1;
        }
      }

      /* --- Polaroid Controls --- */
      .polaroid-controls {
        position: absolute;
        top: -45px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 5px;
        z-index: 50;
        opacity: 0;
        transition: opacity 1s ease-out, transform 0.2s ease-out;
        pointer-events: auto;
      }

      .polaroid:hover .polaroid-controls {
        opacity: 1;
        transform: translateX(-50%) translateY(-2px);
      }

      .polaroid-btn {
        background: rgba(217, 48, 37, 0.95);
        color: white;
        border: none;
        padding: 6px 10px;
        border-radius: 15px;
        font-family: 'Ma Shan Zheng', sans-serif;
        font-size: 12px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        transition: all 0.2s;
        white-space: nowrap;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
      }

      .polaroid-btn:hover {
        background: rgba(185, 45, 32, 0.95);
        transform: scale(1.05);
      }

      .polaroid-btn:active {
        transform: scale(0.95);
      }

      .delete-btn {
        background: rgba(217, 48, 37, 0.95);
      }

      .zoom-in-btn {
        background: rgba(46, 179, 79, 0.95);
      }

      .zoom-out-btn {
        background: rgba(33, 150, 243, 0.95);
      }

      @media (max-width: 768px), (hover: none) {
        .polaroid .polaroid-controls {
          opacity: 0;
          pointer-events: auto;
          transition: opacity 0.3s ease;
        }
        
        .polaroid.tapped .polaroid-controls,
        .polaroid:active .polaroid-controls {
          opacity: 1;
          transform: translateX(-50%) translateY(-2px);
        }
      }

      .flash {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: white;
        opacity: 0;
        pointer-events: none;
        z-index: 10000;
        transition: opacity 0.1s;
      }
      .flash-active {
        opacity: 1;
      }

      @media (max-width: 768px) {
        body {
          flex-direction: column;
        }
        .camera-zone {
          flex: 0 0 auto;
          width: 100%;
          height: auto;
          padding-top: 60px;
          padding-bottom: 40px;
          justify-content: center;
        }
        .desk-zone {
          width: 100%;
          height: 100%;
        }
        .btn-container {
          top: 10px;
          right: 10px;
        }
        .action-btn {
          font-size: 14px;
          padding: 6px 12px;
        }
      }

      .footer-declaration {
        position: fixed;
        bottom: 10px;
        left: 0;
        right: 0;
        text-align: center;
        font-family: 'Ma Shan Zheng', cursive;
        font-size: 14px;
        color: #666;
        z-index: 100;
        pointer-events: none;
        user-select: none;
      }
    </style>
  </head>
  <body>
    <div class="btn-container">
      <a href="index.html" style="display: inline-block; padding: 8px 16px; background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 2px solid #d93025; border-radius: 20px; color: #d93025; text-decoration: none; font-size: 16px; font-weight: 500; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); font-family: 'Ma Shan Zheng', 'Permanent Marker', cursive;">
        â† å›åˆ°é¦–é¡µ
      </a>
      <button class="action-btn" id="download-btn" title="ä¸‹è½½ç…§ç‰‡å¢™">ä¸‹è½½æ‹¼å›¾</button>
      <button class="action-btn" id="reset-btn" title="æ¸…ç©ºæ‰€æœ‰ç…§ç‰‡">æ¸…ç©ºé‡ç½®</button>
    </div>

    <div class="camera-zone">
      <div class="camera-wrapper">
        <div class="ejection-slot" id="slot"></div>
        <div class="lens-wrapper">
          <video id="cam-feed" autoplay playsinline muted></video>
          <div class="lens-shine"></div>
        </div>
        
        <!-- âœ… å·²æ›¿æ¢ï¼šç›¸æœºå›¾ç‰‡é“¾æ¥ -->
        <img
          src="https://photo.hackflow.com.cn/assets/retro-camera.webp" 
          class="camera-img"
          alt="Retro Camera"
          onerror="this.style.background='#333'; this.style.opacity='0.5';"
        />
        
        <div class="shutter-btn" id="shutter"></div>
      </div>
    </div>

    <div class="desk-zone" id="desk"></div>
    <div class="flash" id="flash"></div>
    <canvas id="canvas" style="display: none"></canvas>


    <script>
      const video = document.getElementById('cam-feed');
      const canvas = document.getElementById('canvas');
      const shutter = document.getElementById('shutter');
      const slot = document.getElementById('slot');
      const flash = document.getElementById('flash');
      const desk = document.getElementById('desk');
      const resetBtn = document.getElementById('reset-btn');
      const downloadBtn = document.getElementById('download-btn');
      const cameraZone = document.querySelector('.camera-zone');
      const btnContainer = document.querySelector('.btn-container');

      // âœ… å·²æ›¿æ¢ï¼šå¿«é—¨éŸ³æ•ˆé“¾æ¥
      const printSound = new Audio(
        'https://sounddino.com/index.php?r=load&mp3&id=47250&l=2'
      );
      printSound.volume = 0.6;

      let demosCleared = false;

      navigator.mediaDevices
        .getUserMedia({
          video: { facingMode: 'user', width: 480, height: 480 },
        })
        .then((stream) => (video.srcObject = stream))
        .catch((err) => console.error(err));

      function getTodayDateString() {
        const d = new Date();
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const dd = String(d.getDate()).padStart(2, '0');
        return `${yyyy}/${mm}/${dd}`;
      }

      const demoDate = getTodayDateString();
      
      // âœ… å·²æ›¿æ¢ï¼šæ¼”ç¤ºç…§ç‰‡é“¾æ¥
      const demos = [
        {
          src: 'https://cdn.ourplay.net/community/post/op_23677349_1719681619506.jpg',
          rot: '-5deg',
          top: '30%',
          left: '30%',
        },
        {
          src: 'https://cdn.ourplay.net/community/post/op_23677349_1719681621891.jpg',
          rot: '8deg',
          top: '35%',
          left: '45%',
        },
        {
          src: 'https://i.bobopic.com/small/117042617.jpg',
          rot: '-12deg',
          top: '45%',
          left: '35%',
        },
      ];

      function spawnDemos() {
        desk.innerHTML = '';
        demosCleared = false;
        demos.forEach((d) => {
          if (!d.src.includes('PLACEHOLDER')) {
             createPolaroidElement(
              d.src,
              demoDate,
              d.top,
              d.left,
              d.rot,
              true,
              false
            );
          }
        });
      }

      spawnDemos();

      function createPolaroidElement(
        imgSrc,
        dateStr,
        top,
        left,
        rot,
        isDemo = false,
        isNew = false
      ) {
        const div = document.createElement('div');
        div.className = isDemo ? 'polaroid demo-polaroid' : 'polaroid';

        if (isNew) {
          div.classList.add('developing-start');
        }

        // æ±‰åŒ–æ§åˆ¶æŒ‰é’®å’Œé»˜è®¤æ–‡å­—
        div.innerHTML = `
                <img src="${imgSrc}" onerror="this.src='https://placehold.co/400x400?text=Image+Error'">
                <div class="polaroid-controls">
                    <button class="polaroid-btn delete-btn">ğŸ—‘ï¸ åˆ é™¤</button>
                    <button class="polaroid-btn zoom-in-btn">â• æ”¾å¤§</button>
                    <button class="polaroid-btn zoom-out-btn">â– ç¼©å°</button>
                </div>
                <div class="caption-main" contenteditable="true" spellcheck="false">è®°å½•ä½ çš„ç¬é—´</div>
                <div class="caption-date">${dateStr}</div>
            `;

        if (top) div.style.top = top;
        if (left) div.style.left = left;
        if (rot) div.style.transform = `rotate(${rot})`;

        if (isDemo) {
          desk.appendChild(div);
        } else if (isNew) {
          requestAnimationFrame(() => {
            div.offsetWidth;
            div.classList.add('developing-slow');
            div.classList.remove('developing-start');
          });
        }

        const deleteBtn = div.querySelector('.delete-btn');
        const zoomInBtn = div.querySelector('.zoom-in-btn');
        const zoomOutBtn = div.querySelector('.zoom-out-btn');

        deleteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          e.preventDefault();
          deletePolaroid(div);
        });

        zoomInBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          e.preventDefault();
          zoomPolaroid(div, 1.2);
        });

        zoomOutBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          e.preventDefault();
          zoomPolaroid(div, 0.8);
        });

        const captionMain = div.querySelector('.caption-main');
        if (captionMain) {
          captionMain.addEventListener('input', function() {
            const text = this.textContent;
            if (text.length > 30) {
              this.textContent = text.substring(0, 30);
              const range = document.createRange();
              const sel = window.getSelection();
              range.selectNodeContents(this);
              range.collapse(false);
              sel.removeAllRanges();
              sel.addRange(range);
            }
          });
          
          captionMain.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
              e.preventDefault();
            }
          });
        }

        div.addEventListener('click', function(e) {
          if (e.target.closest('.polaroid-btn') || e.target.closest('.caption-main')) {
            return;
          }
          if (!div.classList.contains('tapped')) {
            div.classList.add('tapped');
            setTimeout(() => {
              if (!div.classList.contains('hovered') && !div.querySelector('.polaroid-controls:hover')) {
                div.classList.remove('tapped');
              }
            }, 3000);
          }
        });
        
        div.addEventListener('mouseenter', function() {
          div.classList.add('hovered');
        });
        
        div.addEventListener('mouseleave', function() {
          div.classList.remove('hovered');
          setTimeout(() => {
            if (!div.querySelector('.polaroid-controls:hover')) {
              div.classList.remove('tapped');
            }
          }, 1000);
        });
        
        const controls = div.querySelector('.polaroid-controls');
        if (controls) {
          controls.addEventListener('mouseenter', function() {
            div.classList.add('hovered');
          });
          
          controls.addEventListener('mouseleave', function() {
            div.classList.remove('hovered');
            setTimeout(() => {
              if (!div.classList.contains('hovered')) {
                div.classList.remove('tapped');
              }
            }, 500);
          });
        }

        makeDraggable(div);
        return div;
      }

      function clearDemos() {
        const demoItems = document.querySelectorAll('.demo-polaroid');
        demoItems.forEach((item) => {
          item.style.opacity = '0';
          item.style.transform = 'scale(0.8)';
          setTimeout(() => item.remove(), 500);
        });
        return true;
      }

      resetBtn.addEventListener('click', () => {
        document.querySelectorAll('.polaroid').forEach((p) => p.remove());
        demosCleared = false;
        desk.innerHTML = '';
        slot.innerHTML = '';
        spawnDemos();
      });

      downloadBtn.addEventListener('click', () => {
        cameraZone.style.display = 'none';
        btnContainer.style.display = 'none';

        html2canvas(document.body, {
          backgroundColor: '#d4d4d4',
          useCORS: true, 
          scale: 2,
        })
          .then((canvas) => {
            const link = document.createElement('a');
            link.download = 'my-polaroid-collage.png';
            link.href = canvas.toDataURL();
            link.click();
            cameraZone.style.display = 'flex';
            btnContainer.style.display = 'flex';
          })
          .catch((err) => {
            console.error('Screenshot failed', err);
            alert(
              'æ— æ³•ä¸‹è½½å›¾ç‰‡ã€‚å¯èƒ½æ˜¯æµè§ˆå™¨çš„å®‰å…¨é™åˆ¶é˜»æ­¢äº†å›¾ç‰‡ä¿å­˜ã€‚'
            );
            cameraZone.style.display = 'flex';
            btnContainer.style.display = 'flex';
          });
      });

      shutter.addEventListener('click', (e) => {
        e.preventDefault();

        if (!demosCleared) {
          clearDemos();
          demosCleared = true;
        }

        flash.classList.add('flash-active');
        setTimeout(() => flash.classList.remove('flash-active'), 100);

        printSound.currentTime = 0;
        printSound.play().catch((e) => {});

        const ctx = canvas.getContext('2d');
        const size = Math.min(video.videoWidth, video.videoHeight);
        canvas.width = 400;
        canvas.height = 400;
        ctx.translate(400, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(
          video,
          (video.videoWidth - size) / 2,
          (video.videoHeight - size) / 2,
          size,
          size,
          0,
          0,
          400,
          400
        );

        ejectPhoto(canvas.toDataURL('image/jpeg'));
      });

      function ejectPhoto(src) {
        if (slot.firstChild) slot.removeChild(slot.firstChild);
        const p = createPolaroidElement(
          src,
          getTodayDateString(),
          null,
          null,
          null,
          false,
          true
        );
        p.classList.add('ejecting');
        slot.appendChild(p);
      }

      function deletePolaroid(polaroidElement) {
        polaroidElement.style.opacity = '0';
        polaroidElement.style.transform = 'scale(0.8)';
        setTimeout(() => {
          polaroidElement.remove();
        }, 300);
      }

      function zoomPolaroid(polaroidElement, scale) {
        const currentTransform = polaroidElement.style.transform;
        const currentScaleMatch = currentTransform.match(/scale\(([^)]+)\)/);
        const currentScale = currentScaleMatch ? parseFloat(currentScaleMatch[1]) : 1;
        const newScale = Math.max(0.5, Math.min(2.0, currentScale * scale));
        
        // ç¼©æ”¾æ—¶ä¿æŒåŸæœ‰çš„ rotate
        const currentRotateMatch = currentTransform.match(/rotate\(([^)]+)\)/);
        const currentRotate = currentRotateMatch ? currentRotateMatch[0] : 'rotate(0deg)';

        polaroidElement.style.transition = 'transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)';
        polaroidElement.style.transform = `${currentRotate} scale(${newScale})`;
        
        setTimeout(() => {
          polaroidElement.style.transition = '';
        }, 300);
      }

      function makeDraggable(elm) {
        let startX = 0,
          startY = 0,
          initialLeft = 0,
          initialTop = 0;
        
        // ç”¨äºè®¡ç®—ç§»åŠ¨é€Ÿåº¦
        let lastX = 0;
        let lastVelocityX = 0;

        elm.addEventListener('mousedown', dragStart);
        elm.addEventListener('touchstart', dragStart, { passive: false });

        function dragStart(e) {
          if (e.target.closest('.caption-main') || e.target.closest('.polaroid-share-btn')) {
            return;
          }

          e.preventDefault();
          
          // ç§»é™¤è½åœ°åŠ¨ç”»ç±»ï¼Œé˜²æ­¢å¹²æ‰°
          elm.classList.remove('dropped');

          if (elm.classList.contains('developing-slow')) {
            elm.classList.remove('developing-slow');
            void elm.offsetWidth;
            elm.classList.add('developing-fast');
          }

          if (elm.classList.contains('ejecting')) {
            const rect = elm.getBoundingClientRect();
            elm.classList.remove('ejecting');
            document.body.appendChild(elm);
            elm.style.position = 'absolute';
            elm.style.left = rect.left + 'px';
            elm.style.top = rect.top + 'px';
            elm.style.transform = 'rotate(0deg) scale(1.1)'; // æ‹¿èµ·æ—¶è½»å¾®æ”¾å¤§
          } else if (elm.parentNode !== document.body) {
            const rect = elm.getBoundingClientRect();
            document.body.appendChild(elm);
            elm.style.left = rect.left + 'px';
            elm.style.top = rect.top + 'px';
          }

          // æ·»åŠ æ‹–æ‹½çŠ¶æ€ç±»ï¼Œè§¦å‘ CSS é˜´å½±åŠ¨ç”»
          elm.classList.add('is-dragging');
          // æ‹¿èµ·æ—¶å˜å¤§ä¸€ç‚¹
          // è·å–å½“å‰ç¼©æ”¾
          const currentTransform = elm.style.transform || '';
          const currentScaleMatch = currentTransform.match(/scale\(([^)]+)\)/);
          const currentScale = currentScaleMatch ? parseFloat(currentScaleMatch[1]) : 1;
          // è®°å½•åŸºç¡€ç¼©æ”¾ï¼Œé¿å…æ‹¿èµ·æ—¶é‡ç½®ç¼©æ”¾
          elm.dataset.baseScale = currentScale; 
          elm.style.transform = `rotate(0deg) scale(${currentScale * 1.1})`; 

          if (e.type === 'touchstart') {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
          } else {
            startX = e.clientX;
            startY = e.clientY;
          }
          
          lastX = startX;
          lastVelocityX = 0;

          initialLeft = elm.offsetLeft;
          initialTop = elm.offsetTop;

          document.addEventListener('mouseup', dragEnd);
          document.addEventListener('mousemove', dragMove);
          document.addEventListener('touchend', dragEnd);
          document.addEventListener('touchmove', dragMove, { passive: false });
        }

        function dragMove(e) {
          e.preventDefault();
          let currentX, currentY;

          if (e.type === 'touchmove') {
            currentX = e.touches[0].clientX;
            currentY = e.touches[0].clientY;
          } else {
            currentX = e.clientX;
            currentY = e.clientY;
          }

          const dx = currentX - startX;
          const dy = currentY - startY;
          
          // è®¡ç®—æ°´å¹³ç§»åŠ¨é€Ÿåº¦ï¼Œç”¨äºäº§ç”Ÿæ›´çµåŠ¨çš„å€¾æ–œ
          const velocityX = currentX - lastX;
          lastX = currentX;
          // ç®€å•çš„å¹³æ»‘æ»¤æ³¢
          lastVelocityX = lastVelocityX * 0.7 + velocityX * 0.3;

          elm.style.left = initialLeft + dx + 'px';
          elm.style.top = initialTop + dy + 'px';

          // ä¼˜åŒ–å€¾æ–œç®—æ³•ï¼šç»“åˆä½ç§»è·ç¦»å’Œç¬æ—¶é€Ÿåº¦
          // åŸºç¡€å€¾æ–œ + æƒ¯æ€§å€¾æ–œ
          const maxTilt = 15;
          const tiltByPos = Math.max(-8, Math.min(8, dx * 0.05));
          const tiltByVel = Math.max(-10, Math.min(10, lastVelocityX * 1.5));
          const totalTilt = Math.max(-maxTilt, Math.min(maxTilt, tiltByPos + tiltByVel));
          
          const baseScale = parseFloat(elm.dataset.baseScale || 1);
          elm.style.transform = `rotate(${totalTilt}deg) scale(${baseScale * 1.1})`;
        }

        function dragEnd() {
          document.removeEventListener('mouseup', dragEnd);
          document.removeEventListener('mousemove', dragMove);
          document.removeEventListener('touchend', dragEnd);
          document.removeEventListener('touchmove', dragMove);

          elm.classList.add('can-share');
          elm.classList.remove('is-dragging');
          
          // æ·»åŠ è½åœ°åŠ¨ç”»ç±»
          elm.classList.add('dropped');

          const finalRot = (Math.random() * 20 - 10).toFixed(1);
          const baseScale = parseFloat(elm.dataset.baseScale || 1);
          
          elm.style.transform = `rotate(${finalRot}deg) scale(${baseScale})`;
          
          // åŠ¨ç”»ç»“æŸåç§»é™¤ç±»åï¼Œæ–¹ä¾¿åç»­æ“ä½œ
          setTimeout(() => {
            elm.classList.remove('dropped');
          }, 400);
        }
      }
    </script>
    
    <div class="footer-declaration">
      ğŸ’¡ å‘±çš„æ‹ç«‹å¾—ç½‘ç«™ | çµæ„Ÿæ¥è‡ª charlie |  é‡åˆ¶ä¸ä¼˜åŒ– gemini
    </div>
  </body>
</html>